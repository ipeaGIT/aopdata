---
title: 'Distribuição espacial de características sociodemográficas e localização de empregos e serviços públicos das 20 maiores cidades do Brasil'
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
```

As bases de dados estão disponibilizadas publicamente para download no site do Projeto Acesso a Oportunidades, e também podem ser baixadas por meio do pacote de R *aopdata*. A função `read_population()` permite fazer o download dos dados de distribuição espacial de características sociodemográficas das cidades analisadas no projeto (Código 1). Por enquanto, estão disponíveis apenas os dados do Censo Demográfico 2010.

```{r}
library(aopdata)

# download dos dados de Belém
dados_belem <- read_population(city = "Belem")

# download dos dados de todas as cidades
dados_todas <- read_population(city = "all")
```

Já a função `read_land_use()` faz o download, além dos dados sociodemográficos, dos dados de localização de empregos e de serviços públicos. Nesse caso, o usuário precisa especificar o ano de referência dos dados: 2017, 2018 ou 2019 (Código 2).

```{r}
# download dos dados de Belo Horizonte
dados_bh <- read_landuse(city = "Belo Horizonte", year = 2018, geometry = TRUE)

# download dos dados de todas as cidades
dados_todas <- read_landuse(city = "all", year = 2018)
```

Ambas as funções `read_population()` e `read_land_use()` possuem um parâmetro chamado `geometry`. Quando o usuário roda essas funções com o parâmetro `geometry = TRUE`, as funções retornam a base de dados já com as informações espaciais da geometria da grade de hexágonos H3, o que permite a criação de mapas para visualizar a distribuição espacial dos dados. As Figuras 1 e 2 ilustram respectivamente os mapas de distribuição espacial da população e de hospitais nas cidades do Rio de Janeiro e de Fortaleza, respectivamente.

```{r}
library(ggplot2)
library(geobr)
library(patchwork)
library(viridisLite)

## mapa da distribuição espacial de uso do solo de Belo Horizonte


# download dos dados AOP de Belo Horizonte
dados_bh <- read_landuse(city = "Belo Horizonte", year = 2018, geometry = TRUE)

# download da fronteira do municipio de BH
muni_bh <- read_municipality()
muni_bh <- subset(muni_bh, name_muni == 'Belo Horizonte')

# figuras parciais
f_pop <- ggplot() +
            geom_sf(data=muni_bh, fill='#ccc8c7', color=NA) +
            geom_sf(data=subset(dados_bh, P001>0), aes(fill = P001), color = NA, alpha = 0.7) +
            scale_fill_viridis_c(option = 'E', direction = 1, na.value=NA) +
            labs(subtitle = "População 2010", fill = "Número\nde habitantes") +
            theme_void()

f_inc <- ggplot() +
  geom_sf(data=muni_bh, fill='#ccc8c7', color=NA) +
  geom_sf(data=subset(dados_bh, P001>0), aes(fill = as.factor(R003)), color = NA, alpha = 0.7) +
  scale_fill_brewer(palette = "RdBu", direction = 1, na.value=NA) +
  labs(subtitle = "Renda 2010", fill = "Decis de\nrenda") +
  theme_void()

f_job <- ggplot() +
  geom_sf(data=muni_bh, fill='#ccc8c7', color=NA) +
  geom_sf(data=subset(dados_bh, P001>0), aes(fill = R003), color = NA, alpha = 0.7) +
  # scale_fill_viridis_c(option = 'Inferno', direction = 1, na.value=NA) +
  viridis::scale_fill_viridis(option = "Inferno"
                            ,limits = c(0,2000)
                            ,breaks= c(seq(0,1500,by = 500),2000)
                            ,labels = c(seq(0,1500,by = 500),"2000 ou mais"))+
  labs(subtitle = "Renda 2010", fill = "Decis de\nrenda") +
  theme_void()

f_sau <- ggplot() +
  geom_sf(data=muni_bh, fill='#ccc8c7', color=NA) +
  geom_sf(data=subset(dados_bh, S001>0), aes(fill = as.factor(S001)), color = NA, alpha = 0.9) +
  scale_fill_brewer(palette = "YlOrRd", direction = 1, na.value=NA) +
  labs(subtitle = "Estabelecimentos de saúde 2019", fill = "Número abs.") +
  theme_void()

f_edu <- ggplot() +
  geom_sf(data=muni_bh, fill='#ccc8c7', color=NA) +
  geom_sf(data=subset(dados_bh, E001>0), aes(fill = as.factor(E001)), color = NA, alpha = 0.9) +
  scale_fill_brewer(palette = "YlOrRd", direction = 1, na.value=NA) +
  labs(subtitle = "Escolas 2019", fill = "Número abs.") +
  theme_void()

f_cra <- ggplot() +
  geom_sf(data=muni_bh, fill='#ccc8c7', color=NA) +
  geom_sf(data=subset(dados_bh, E001>0), aes(fill = as.factor(E001)), color = NA, alpha = 0.9) +
  scale_fill_brewer(palette = "YlOrRd", direction = -1, na.value=NA) +
  labs(subtitle = "Escolas 2019", fill = "Número abs.") +
  theme_void()

# figura final
fig <- plot_grid(f_pop, f_inc, f_job, f_sau, f_edu, f_cra, ncol = 2)

ggsave(fig, filename = 'fig.png', 
       width = 16, height = 25, units = 'cm')

```
